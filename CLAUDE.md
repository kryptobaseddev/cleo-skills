# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

<!-- CLEO:START -->
@.cleo/templates/AGENT-INJECTION.md
<!-- CLEO:END -->

## Project Overview

**cleo-skills** is the official skills library for the CLEO multi-agent orchestration ecosystem. Skills are agentskills.io-compliant `SKILL.md` markdown files that CLEO injects as context into subagent spawns. This repo is consumed by CLEO via CAAMP (package management).

As of v2.0.0, this is also a **Registry/Catalog API** — a Node.js package (`@cleocode/ct-skills`) with programmatic access to skill metadata, dependency resolution, install profiles, and protocol files. Skills remain markdown documents; the API provides structured access.

## Build Commands

```bash
# Validate frontmatter and generate skills.json
bash scripts/build-index.sh

# Generate manifest.json from frontmatter + dispatch-config.json
node scripts/build-manifest.js

# Both at once
npm run build:all
```

The build scans `skills/*/SKILL.md`, validates frontmatter and body constraints, and generates `skills.json`. The manifest build merges frontmatter with `dispatch-config.json` routing rules. Exits non-zero on validation errors but still writes output.

## Architecture

```
CLEO (orchestrator) ──> CAAMP (package mgmt) ──> cleo-skills (this repo)
                                                    ├── skills/*/SKILL.md      skill content (17 skills)
                                                    ├── skills/_shared/        protocol infrastructure
                                                    ├── protocols/*.md         12 protocol definitions
                                                    ├── profiles/*.json        4 install profiles
                                                    ├── dispatch-config.json   manual routing rules
                                                    ├── manifest.json          CLEO dispatch registry (auto-gen)
                                                    ├── skills.json            CAAMP index (auto-gen)
                                                    ├── index.js               Registry/Catalog API
                                                    └── bin/ct-skills.js       CLI
```

**2-tier subagent model**: CLEO uses a single `cleo-subagent` executor type. Skill names like `ct-research-agent` are protocol identifiers, not separate agent types. The orchestrator (Tier 0) injects skill content as context into subagent spawns (Tier 1).

**Protocol stack**: Every subagent spawn combines a skill-specific `SKILL.md` (top layer) with shared infrastructure from `_shared/` (base layer). Skills never reference `_shared/` directly — CLEO injects it at spawn time.

## Dual Manifest System

Two manifests serve different consumers from the same SKILL.md frontmatter source of truth:

- **`skills.json`** — auto-generated by `build-index.sh`. Consumed by CAAMP for install/discovery. Contains: name, description, version, path, core, category, tier, protocol, dependencies, sharedResources, compatibility, license. **Never edit manually.**
- **`manifest.json`** — auto-generated by `build-manifest.js` from frontmatter + `dispatch-config.json`. Consumed by CLEO orchestrator for dispatch routing, token budgets, tier levels, and chaining rules. Contains: dispatch_matrix, token_budget, chains_to, dispatch_triggers, constraints.

See `docs/DEVELOPER-GUIDE.md` for complete field schemas and configuration examples for both manifests.

## Skill Structure

```
skills/ct-example/
├── SKILL.md           # Required — frontmatter + instructions (<500 lines)
├── references/        # Optional — deep-dive docs (one level deep only)
├── scripts/           # Optional — executable helpers
└── assets/            # Optional — templates or data
```

### Frontmatter Requirements (v2.0.0)

```yaml
---
name: ct-example          # Required: must match directory name
description: >-           # Required: max 1024 chars, state WHAT + WHEN
  Description here.
version: 1.0.0            # Skill version (semver)
tier: 2                   # 0=orchestration, 1=planning, 2=execution, 3=specialized
core: false               # Required for basic CLEO? (boolean)
category: specialist      # core | recommended | specialist | composition | meta
protocol: implementation  # Protocol binding from protocols/ (or null)
dependencies: []          # Other ct-* skills required
sharedResources:          # _shared/ files needed at spawn
  - subagent-protocol-base
  - task-system-integration
compatibility:            # Supported AI agents
  - claude-code
  - cursor
  - windsurf
  - gemini-cli
license: MIT
---
```

**Name rules**: lowercase `a-z0-9-`, max 64 chars, no leading/trailing/consecutive hyphens, must exactly match parent directory name.

**Body limit**: under 500 lines (hard), under 5000 tokens (recommended). Move detailed content to `references/`.

## Adding a New Skill

1. Create `skills/ct-newname/` directory
2. Write `SKILL.md` with valid frontmatter (all fields shown above)
3. Add `references/`, `scripts/`, or `assets/` as needed
4. Add dispatch routing to `dispatch-config.json` (token budget, triggers, chaining)
5. Run `bash scripts/build-index.sh` to validate and generate `skills.json`
6. Run `node scripts/build-manifest.js` to generate `manifest.json`

Full spec: `docs/SKILL-SPECIFICATION.md`
End-to-end walkthrough with examples: `docs/DEVELOPER-GUIDE.md`

## Key Directories

- `skills/_shared/` — Protocol infrastructure injected by CLEO at spawn time (not a skill, excluded from `skills.json`). Changes here affect all skills. Contains lifecycle rules, manifest operations, task integration patterns, style guide, and `placeholders.json` (defines all `{{TOKEN}}` variables). See `docs/DEVELOPER-GUIDE.md` "Leveraging `_shared/` for DRY Principles" for concrete usage patterns.
- `protocols/` — 12 protocol definition files (agent-protocol, research, specification, implementation, etc.) bound to skills via the `protocol` frontmatter field.
- `profiles/` — 4 install profiles (minimal, core, recommended, full) for CAAMP installation.
- `docs/SKILL-SPECIFICATION.md` — Authoritative skill authoring rules (frontmatter, naming, validation, progressive disclosure).
- `docs/DEVELOPER-GUIDE.md` — Comprehensive developer guide with end-to-end examples, complete `skills.json` and `manifest.json` schemas, token budget guidance, and `_shared/` DRY patterns.
- `scripts/build-index.sh` — Validates skills and generates `skills.json`.
- `scripts/build-manifest.js` — Generates `manifest.json` from frontmatter + `dispatch-config.json`.

## Conventions

- Skills are organized by tier: 0 (orchestration), 1 (planning), 2 (execution), 3 (specialized)
- Token placeholders (`{{TASK_ID}}`, `{{EPIC_ID}}`, etc.) in skills are resolved by the orchestrator before spawn — subagents receive concrete values
- Cross-agent compatibility: CLEO extension fields (`version`, `tier`) are ignored by non-CLEO agents. Standard `name` and `description` ensure universal discoverability
- Writing style follows `skills/_shared/cleo-style-guide.md`: conversational, use contractions, lead with important information, no corporate jargon
