# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

<!-- CLEO:START -->
@.cleo/templates/AGENT-INJECTION.md
<!-- CLEO:END -->

## Project Overview

**cleo-skills** is the official skills library for the CLEO multi-agent orchestration ecosystem. Skills are agentskills.io-compliant `SKILL.md` markdown files that CLEO injects as context into subagent spawns. This repo is consumed by CLEO via CAAMP (package management).

This is a **content repository** — skills are markdown documents, not executable code. There is no package.json, no test framework, and no linter.

## Build Command

```bash
bash scripts/build-index.sh
```

This is the only build step. It scans `skills/*/SKILL.md`, validates frontmatter and body constraints, and generates `skills.json`. Run after any skill changes. Exits non-zero on validation errors but still writes output.

## Architecture

```
CLEO (orchestrator) ──> CAAMP (package mgmt) ──> cleo-skills (this repo)
                                                    ├── skills/*/SKILL.md   skill content
                                                    ├── skills/_shared/     protocol infrastructure
                                                    ├── manifest.json       CLEO dispatch registry (manual)
                                                    └── skills.json         agentskills.io index (auto-generated)
```

**2-tier subagent model**: CLEO uses a single `cleo-subagent` executor type. Skill names like `ct-research-agent` are protocol identifiers, not separate agent types. The orchestrator (Tier 0) injects skill content as context into subagent spawns (Tier 1).

**Protocol stack**: Every subagent spawn combines a skill-specific `SKILL.md` (top layer) with shared infrastructure from `_shared/` (base layer). Skills never reference `_shared/` directly — CLEO injects it at spawn time.

## Dual Manifest System

Two manifests serve different consumers from the same SKILL.md frontmatter source of truth:

- **`skills.json`** — auto-generated by `build-index.sh`. Consumed by CAAMP for install/discovery. **Never edit manually.**
- **`manifest.json`** — manually maintained. Consumed by CLEO orchestrator for dispatch routing, token budgets, tier levels, and chaining rules. Must be updated when adding skills or changing capabilities.

## Skill Structure

```
skills/ct-example/
├── SKILL.md           # Required — frontmatter + instructions (<500 lines)
├── references/        # Optional — deep-dive docs (one level deep only)
├── scripts/           # Optional — executable helpers
└── assets/            # Optional — templates or data
```

### Frontmatter Requirements

```yaml
---
name: ct-example          # Required: must match directory name
description: >-           # Required: max 1024 chars, state WHAT + WHEN
  Description here.
version: 1.0.0            # CLEO extension
tier: 2                   # CLEO extension (0=orchestration, 1=planning, 2=execution, 3=specialized)
---
```

**Name rules**: lowercase `a-z0-9-`, max 64 chars, no leading/trailing/consecutive hyphens, must exactly match parent directory name.

**Body limit**: under 500 lines (hard), under 5000 tokens (recommended). Move detailed content to `references/`.

## Adding a New Skill

1. Create `skills/ct-newname/` directory
2. Write `SKILL.md` with valid frontmatter (`name` and `description` required)
3. Add `references/`, `scripts/`, or `assets/` as needed
4. Add entry to `manifest.json` with dispatch triggers, token budget, tier, and chaining rules
5. Run `bash scripts/build-index.sh` to validate

Full spec: `docs/SKILL-SPECIFICATION.md`

## Key Directories

- `skills/_shared/` — Protocol infrastructure injected by CLEO at spawn time (not a skill, excluded from `skills.json`). Changes here affect all skills. Contains lifecycle rules, manifest operations, task integration patterns, style guide, and `placeholders.json` (defines all `{{TOKEN}}` variables).
- `docs/SKILL-SPECIFICATION.md` — Authoritative skill authoring rules (frontmatter, naming, validation, progressive disclosure).
- `scripts/build-index.sh` — The only build script. Validates skills and generates `skills.json`.

## Conventions

- Skills are organized by tier: 0 (orchestration), 1 (planning), 2 (execution), 3 (specialized)
- Token placeholders (`{{TASK_ID}}`, `{{EPIC_ID}}`, etc.) in skills are resolved by the orchestrator before spawn — subagents receive concrete values
- Cross-agent compatibility: CLEO extension fields (`version`, `tier`) are ignored by non-CLEO agents. Standard `name` and `description` ensure universal discoverability
- Writing style follows `skills/_shared/cleo-style-guide.md`: conversational, use contractions, lead with important information, no corporate jargon
